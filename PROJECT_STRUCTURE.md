# Project Structure

Complete file listing for TURSHIA.BOT.

## Root Configuration Files

- **package.json** - NPM dependencies and scripts
- **tsconfig.json** - TypeScript configuration
- **vite.config.ts** - Vite bundler configuration
- **wrangler.toml** - Cloudflare Pages and KV configuration
- **.editorconfig** - Editor formatting rules
- **.eslintrc.cjs** - ESLint configuration
- **.prettierrc** - Prettier code formatting
- **.gitignore** - Git ignore patterns
- **index.html** - HTML entry point

## Documentation

- **README.md** - Complete documentation with setup, API docs, troubleshooting
- **QUICKSTART.md** - Fast setup guide
- **PROJECT_STRUCTURE.md** - This file
- **LICENSE** - MIT License

## Source Code

### Frontend (`/src`)
- **main.tsx** - React app entry point
- **App.tsx** - Main chat UI component with localStorage persistence
- **App.css** - Responsive chat UI styles
- **index.css** - Global styles
- **vite-env.d.ts** - Vite TypeScript definitions

### Backend (`/functions/api`)
- **chat.ts** - Cloudflare Pages Function
  - POST /api/chat endpoint
  - Rate limiting with KV
  - Provider abstraction (Gemini/Groq)
  - CORS handling
  - Input validation
  - Persona prompt engineering

### Public Assets (`/public`)
- **vite.svg** - Favicon

## CI/CD (`/.github/workflows`)

- **ci.yml** - Continuous Integration
  - Runs on: push to main, pull requests
  - Steps: lint, typecheck, build

- **deploy-pages.yml** - Deployment pipeline
  - Runs on: push to main
  - Deploys to Cloudflare Pages

## Environment Configuration

- **.dev.vars.example** - Example local environment variables
- **.dev.vars** - Local secrets (gitignored, you create this)

## Key Features by File

### Rate Limiting (chat.ts:47-74)
- Fixed window algorithm
- Cloudflare KV storage
- Per-IP tracking
- Configurable limits via env vars

### LLM Provider Abstraction (chat.ts:93-197)
- Gemini API integration with flash model
- Groq API integration with Llama
- Unified interface
- Switchable via LLM_PROVIDER env var

### Persona System (chat.ts:28-41)
- Base system prompt with strict constraints
- Mode modifiers (soft/snappy)
- Bulgarian-only responses
- Safety guardrails
- Question injection pattern

### Chat UI (App.tsx)
- Message history with localStorage
- Two personality modes
- Real-time interaction
- Error handling
- Responsive design

### Validation (chat.ts:219-256)
- JSON schema validation
- Message length limits (2000 chars)
- History trimming (12 turns)
- Role validation
- Mode validation

## Build Output (`/dist`)

Generated by `npm run build`:
- index.html
- assets/
  - index-[hash].css
  - index-[hash].js
  - vite.svg

## Configuration Summary

| Config | File | Purpose |
|--------|------|---------|
| TypeScript | tsconfig.json | Compiler options |
| Bundler | vite.config.ts | Dev server, build, proxy |
| Linting | .eslintrc.cjs | Code quality |
| Formatting | .prettierrc | Code style |
| Editor | .editorconfig | Cross-editor consistency |
| Cloudflare | wrangler.toml | Pages and KV config |
| CI/CD | .github/workflows/*.yml | Automation |

## Environment Variables

### Required (Production)
- `LLM_PROVIDER` - "gemini" or "groq"
- `GEMINI_API_KEY` or `GROQ_API_KEY` - LLM API credentials

### Optional (Production)
- `RATE_LIMIT_MAX` - Max requests per window (default: 30)
- `RATE_LIMIT_WINDOW_SEC` - Window size (default: 600)

### KV Binding
- `RATE_KV` - Cloudflare KV namespace for rate limiting

## Package Scripts

```json
{
  "dev": "vite",                    // Frontend dev server
  "build": "tsc && vite build",     // Production build
  "preview": "vite preview",        // Preview build
  "lint": "eslint ...",             // Run linter
  "typecheck": "tsc --noEmit",      // Type checking
  "pages:dev": "wrangler pages dev", // Backend dev server
  "pages:deploy": "wrangler pages deploy" // Manual deploy
}
```

## Total Files Created

**Configuration:** 9 files
**Source Code:** 6 files
**Documentation:** 4 files
**CI/CD:** 2 files
**Assets:** 1 file

**Total:** 22 files

## Dependencies

### Production
- react ^18.3.1
- react-dom ^18.3.1

### Development
- @cloudflare/workers-types ^4.20241230.0
- @types/react ^18.3.12
- @types/react-dom ^18.3.1
- @typescript-eslint/* ^7.18.0
- @vitejs/plugin-react ^4.3.3
- eslint ^8.57.1
- eslint-plugin-react-* ^4.6.2
- prettier ^3.3.3
- typescript ^5.6.3
- vite ^5.4.11
- wrangler ^3.95.0

## Architecture Decisions

1. **Single Repository** - Frontend and backend in one repo for simplicity
2. **TypeScript Everywhere** - Type safety across stack
3. **No Database** - localStorage for client, KV for rate limiting only
4. **Provider Abstraction** - Easy to swap or add LLM providers
5. **Pages Functions** - Native Cloudflare integration, no Workers setup
6. **GitHub Actions** - Standard CI/CD, no external services
7. **Minimal Dependencies** - Only essential packages
8. **No Streaming** - Simpler implementation, can add later
9. **Fixed Window Rate Limiting** - Simple and effective
10. **No Authentication** - Public bot, rate limited by IP

## Security Measures

- Input validation and sanitization
- Rate limiting per IP
- CORS restrictions
- API keys in secrets (not code)
- No user data storage
- Content safety in prompts
- No XSS/injection vectors
- Secure headers

## Performance

- Client-side caching (localStorage)
- Minimal bundle size (~145KB)
- Fast LLM providers (Flash/Llama)
- Cloudflare edge network
- No database overhead
- Efficient KV operations

## Future Extensibility

Code is structured to easily add:
- Streaming responses (WebSocket or SSE)
- More LLM providers
- User authentication
- Conversation export
- Analytics/logging
- More personality modes
- Multi-language support
- Voice interface
